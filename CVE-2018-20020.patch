From 360bc008fc8bb249e0e002a9de13f69e13c03776 Mon Sep 17 00:00:00 2001
From: Christian Beier <dontmind@freeshell.org>
Date: Thu, 4 Oct 2018 22:27:39 +0200
Subject: [PATCH] LibVNCClient: really fix #250

Signed-off-by: Arzhan Kinzhalin <arzhan.i.kinzhalin@intel.com>
---
This is upstream 7b1ef0ffc48 rebase onto LibVNCServer-0.9.11 (tag)
---
 libvncclient/corre.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/libvncclient/corre.c b/libvncclient/corre.c
index baf91cc..5ee96b9 100644
--- a/libvncclient/corre.c
+++ b/libvncclient/corre.c
@@ -48,7 +48,7 @@ HandleCoRREBPP (rfbClient* client, int rx, int ry, int rw, int rh)
 
     FillRectangle(client, rx, ry, rw, rh, pix);
 
-    if (!ReadFromRFBServer(client, client->buffer, hdr.nSubrects * (4 + (BPP / 8))))
+    if (hdr.nSubrects > RFB_BUFFER_SIZE / (4 + (BPP / 8)) || !ReadFromRFBServer(client, client->buffer, hdr.nSubrects * (4 + (BPP / 8))))
 	return FALSE;
 
     ptr = (uint8_t *)client->buffer;
-- 
2.20.0

